<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--This is a SEO change.-->
    <!--Added the meta tag with name description which contains important information regarding this personal 
    budget website. Adding this information helps in achieving a higher SEO score.-->
    <meta name="description" content="This is a Personal budget website used to manage,track and update your
    personal budget. This was created by Saumit Chinchkhandi.">

    <!--This is a SEO change-->
    <!-- The open graph tags are used for increasing and modifying website appearance on social media platforms like 
    Facebook. More impressions will let more users view your site and is also an important SEO practice.-->
    <meta name="og:title" property="og:title" content="Personal Budget Website" />    
    <meta property="og:description" content="A Budget website for tracking and analyzing your spending and providing
    detailed insights and patterns!!" />
    <meta property="og:type" content="website" />

    <title>Personal Budget</title>
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./main.css">



    <style>
        
        svg {
            width: 800px;
            height: 500px;
        }
        
        path.slice{
            stroke-width:2px;
        }
        
        polyline{
            opacity: .3;
            stroke: black;
            stroke-width: 2px;
            fill: none;
        }
        
        </style>

</head>
<body>
    
    <nav>
        <!-- This is a Semantic HTML Change -->
        <!-- The <nav> element tag encloses section of the code intended to have navigation links to 
        different sub pages(About, Login, Google) in the website. This is an important semantic
        html change as it lets browser know the content enclosed in these tags contains navigation links. -->
        <div class="menu">
            <ul>
                <li><a href="/">Homepage</a></li>
                <!--This is a SEO change.-->
                <!--Added the rel="nofollow" attribute to the anchor tag which is pointing to google.com. This helps in
                not increasing domain authority of an external website used in anchor tag so no other websites are 
                getting any advantage by just mentioning their URL's. This is also an important SEO practice. -->
                <li><a href="./about.html" rel="nofollow">About</a></li>
                <li><a href="./login.html" rel="nofollow">Login</a></li>
                <li><a href="https://google.com" rel="nofollow">Google</a></li>
            </ul>
        </div>
    </nav>
    

    <div class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
    </div>


    <!--This is an A11y change-->
    <!--I have added the role="main" which is an ARIA landmark which are an important feature to increase page accessibility.
    This particular div has the role main attached to it and each website should have at most 1 main landmark.-->
    <div role="main" class="container center">

        <div class="page-area">

            <article role="region">
                <!-- This is a Semantic HTML Change -->
                <!-- The <article> element tag encloses independent content inside a section of a website.
                In this website, I have used article tag to enclose different features of my personal budget site. -->
                <div class="text-box">
                    <!--This is an A11y Accessibility change-->
                    <!--It is a common practice to only have 1 <h1> tag in the entire website which is usually used for
                    denoting the heading. Other sub-headings can then use header tags from h2-h6. This is an important 
                    A11y change.-->
                    <h3>Stay on track</h3>
                    <p>
                        Do you know where you are spending your money? If you really stop to track it down,
                        you would get surprised! Proper budget management depends on real data... and this
                        app will help you with that!
                    </p>
                </div>
            </article>
            
            <article role="region">
                <div class="text-box">
                    <h3>Alerts</h3>
                    <p>
                        What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    </p>
                </div>
            </article>
            
            
            <article role="region">
                <div class="text-box">
                    <h3>Results</h3>
                    <p>
                        People who stick to a financial plan, budgeting every expense, get out of debt faster!
                        Also, they to live happier lives... since they expend without guilt or fear... 
                        because they know it is all good and accounted for.
                    </p>
                </div>
            </article>
            
    
            <article role="region">
                <div class="text-box">
                    <h3>Free</h3>
                    <p>
                        This app is free!!! And you are the only one holding your data!
                    </p>
                </div>
            </article>
            
    
            <article role="region">
                <div class="text-box">
                    <h3>Stay on track</h3>
                    <p>
                        Do you know where you are spending your money? If you really stop to track it down,
                        you would get surprised! Proper budget management depends on real data... and this
                        app will help you with that!
                    </p>
                </div>
            </article>
            
            <article role="region">
                <div class="text-box">
                    <h3>Alerts</h3>
                    <p>
                        What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    </p>
                </div>
            </article>
            
    
            <article role="region">
                <div class="text-box">
                    <h3>Results</h3>
                    <p>
                        People who stick to a financial plan, budgeting every expense, get out of debt faster!
                        Also, they to live happier lives... since they expend without guilt or fear... 
                        because they know it is all good and accounted for.
                    </p>
                </div>
            </article>
            
    
            <article role="region">
                <!--This is an A11y Accessibility change-->
                <!--Having role="region" is used to mark region in the website used to mark significant regions.-->
                <div class="text-box">
                    <h3>Week 04 Budget Pie Chart</h3>
                    <p>
                        <canvas id="myChart" width="400" height="400"></canvas>
                    </p>
                </div>
                <h3>Week 04 D3JS Chart</h3>
                <div id="pie-chart"></div> 
            </article>
            
        </div>

    </div>

    <footer>
        <!-- This is a Semantic HTML Change -->
        <!-- The <footer> element tag encloses section of the code intended to have author, version
        and copyright information of the website. This is also an important Semantic HTML change
        as it helps the browser and other developer better understand and structure the code.-->
        <div role="contentinfo" class="bottom">
            <!--This is an A11y Accessibility change-->
            <!--Having role="contentinfo" is used to mark region in the website used to contain identifying
            information like author, copyright etc.-->
            <div class="center">
                All rights reserved &copy; Saumit Chinchkhandi
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js" integrity="sha512-aoTNnqZcT8B4AmeCFmiSnDlc4Nj/KPaZyB5G7JnOnUEkdNpCZs1LCankiYi01sLTyWy+m2P+W4XM+BuQ3Q4/Dg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js" integrity="sha512-7U4rRB8aGAHGVad3u2jiC7GA5/1YhQcQjxKeaVms/bT66i3LVBMRcBI9KwABNWnxOSwulkuSXxZLGuyfvo7V1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var dataSource = {
            datasets: [
                {
                    data:[],
                    backgroundColor: [
                        //'#ffcd56',
                        //'#ff6384',
                        //'#36a2eb',
                        //'#fd6b19',
                        '#C70039', //red
                        '#FFC300', //yellow
                        '#16E738', //green
                        '#339EFF', //blue
                        '#C416E7', //purple
                        '#FF5733', //orange
                        '#ABB2B9' //grey

                    ],
                }
            ],
            labels: []
        };

        function createChart(){
            var ctx = document.getElementById("myChart").getContext("2d");
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: dataSource
            });
        }

        function getBudget() {
            var d3_chartData = [];
            axios.get('/budget')
            .then(function (res){
                console.log(res);
                for(var i=0; i < res.data.length; i++){ //Using data from modifiedBudget array in w4budget.json file
                    dataSource.datasets[0].data[i] = res.data[i].relatedValue;
                    dataSource.labels[i] = res.data[i].title;

                    var data = res.data[i];
                    d3_chartData.push({ label: data.title, value: data.relatedValue });

                }
                createChart();
                change(d3_chartData); //data from modifiedBudget passed to d3js change function
                
            });
        }

        getBudget();
    </script>



    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>

var svg = d3.select("#pie-chart")
	.append("svg")
	.append("g")

svg.append("g")
	.attr("class", "slices");
svg.append("g")
	.attr("class", "labels");
svg.append("g")
	.attr("class", "lines");

var width = 960,
    height = 450,
	radius = Math.min(width, height) / 2;

var pie = d3.layout.pie()
	.sort(null)
	.value(function(d) {
		return d.value;
	});

var arc = d3.svg.arc()
	.outerRadius(radius * 0.8)
	.innerRadius(radius * 0.4);

var outerArc = d3.svg.arc()
	.innerRadius(radius * 0.9)
	.outerRadius(radius * 0.9);

svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var key = function(d){ return d.data.label; };

var color = d3.scale.ordinal()
	.range(["#00bfff", "#ff4000", "#40ff00", "#FFC300", "#ABB2B9", "#E444A1", "#091514"]);


function change(data) {

	/* ------- PIE SLICES -------*/
	var slice = svg.select(".slices").selectAll("path.slice")
		.data(pie(data), key);

	slice.enter()
		.insert("path")
		.style("fill", function(d) { return color(d.data.label); })
		.attr("class", "slice");

	slice		
		.transition().duration(1000)
		.attrTween("d", function(d) {
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				return arc(interpolate(t));
			};
		})

	slice.exit()
		.remove();

	/* ------- TEXT LABELS -------*/

	var text = svg.select(".labels").selectAll("text")
		.data(pie(data), key);

	text.enter()
		.append("text")
		.attr("dy", ".35em")
		.text(function(d) {
			return d.data.label;
		});
	
	function midAngle(d){
		return d.startAngle + (d.endAngle - d.startAngle)/2;
	}

	text.transition().duration(1000)
		.attrTween("transform", function(d) {
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				var pos = outerArc.centroid(d2);
				pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
				return "translate("+ pos +")";
			};
		})
		.styleTween("text-anchor", function(d){
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				return midAngle(d2) < Math.PI ? "start":"end";
			};
		});

	text.exit()
		.remove();

	/* ------- SLICE TO TEXT POLYLINES -------*/

	var polyline = svg.select(".lines").selectAll("polyline")
		.data(pie(data), key);
	
	polyline.enter()
		.append("polyline");

	polyline.transition().duration(1000)
		.attrTween("points", function(d){
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				var pos = outerArc.centroid(d2);
				pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
				return [arc.centroid(d2), outerArc.centroid(d2), pos];
			};			
		});
	
	polyline.exit()
		.remove();
};

    </script>


</body>
</html>